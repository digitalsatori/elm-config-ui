<!DOCTYPE html>
<html>
  <head>
    <title>Config Example</title>

    <style>
      html, body {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="elm"></div>

    <!-- compiled elm code -->
    <script src="./js/compiled/main.js"></script>

    <!-- config helper -->
    <script src="./js/config.js"></script>

    <script>
      const LOCALSTORAGE_KEY = "config_example_boids";

      const node = document.getElementById('elm');

      fetch('./data/config.json')
        .then(function(resp) { return resp.json() })
        .then(function(json) { init(json) });

      function init(configFile) {
        // start main Elm app
        let app = Elm.Main.init({
          node: node,
          flags: {
            localStorage: JSON.parse(localStorage.getItem(LOCALSTORAGE_KEY)),
            configFile: configFile,
            timestamp: Date.now(),
          }
        });

        ConfigForm.init(app);
        /* -- meta
          shouldShowCopyConfigBtn: field
        */

        app.ports.sendToPort.subscribe(function(effect) {
          switch (effect.id) {
            case "SAVE":
              localStorage.setItem(
                LOCALSTORAGE_KEY,
                JSON.stringify(effect.val),
              );
              break;
            case "CONFIG":
              ConfigForm.receivePortMsg(effect.val, node);
              break;
            case "COPY_CONFIG":
              let configJson = JSON.stringify(effect.val);
              window.prompt("Copy and paste to your config.json.", configJson);
              break;
            default:
              console.error("Unknown Effect", effect);
          }
        });
      }
    </script>

    <script>
      // https://github.com/mrdoob/stats.js/
      //(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//mrdoob.github.io/stats.js/build/stats.min.js';document.head.appendChild(script);})()
    </script>
  </body>
</html>
