<!DOCTYPE html>
<html>
  <head>
    <title>Config Example</title>
  </head>
  <body>
    <div id="elm"></div>

    <!-- compiled elm code -->
    <script src="./js/compiled/main.js"></script>

    <!-- config helper -->
    <script src="./js/config.js"></script>

    <script>
      const LOCALSTORAGE_KEY = "config_example";

      const node = document.getElementById('elm');

      fetch('./data/config.json')
        .then(function(resp) { return resp.json() })
        .then(function(json) { init(json) });

      function init(configFile) {
        // start main Elm app
        let app = Elm.Main.init({
          node: node,
          flags: {
            localStorage: JSON.parse(localStorage.getItem(LOCALSTORAGE_KEY)),
            configFile: configFile,
          }
        });

        ConfigForm.init(app);
        /* -- meta
          shouldShowCopyConfigBtn: field
        */

        app.ports.sendToPort.subscribe(function(effect) {
          switch (effect.id) {
            case "SAVE":
              localStorage.setItem(
                LOCALSTORAGE_KEY,
                JSON.stringify(effect.val),
              );
              break;
            case "CONFIG":
              ConfigForm.receivePortMsg(effect.val, node);
              break;
            case "COPY_CONFIG":
              let configJson = JSON.stringify(effect.val);
              window.prompt("Copy and paste to your config.json.", configJson);
              break;
            default:
              console.error("Unknown Effect", effect);
          }
        });
      }
    </script>
  </body>
</html>
